<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Система обнаружения телефонов</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #f44ffe 0%, #020004 100%);
      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;
      padding: 30px 20px 10px 20px;
      color: #fff;
    }

    header h1 {
      margin: 0;
      font-size: 32px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .section {
      background: #fff;
      border-radius: 10px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .section h2 {
      margin: 0 0 20px 0;
      text-align: center;
      font-size: 28px;
    }

    .upload-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .custom-file-upload {
      background: #8000ba;
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .custom-file-upload input[type="file"] {
      display: none;
    }

    .file-name {
      flex: 1;
      text-align: center;
      font-size: 14px;
      color: #333;
    }

    .process-btn {
      background: #8000ba;
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .process-btn:hover {
      background: #390053;
    }

    button {
      font-size: 14px;
    }

    img {
      display: block;
      margin: 15px 0;
      max-width: 100%;
      border: 2px solid #ccc;
      border-radius: 4px;
    }

    #stats, #videoStats {
      font-weight: bold;
      color: #333;
      margin: 5px 0;
    }

    footer {
      background: #440066;
      color: #fff;
      text-align: center;
      padding: 15px;
      font-size: 14px;
      margin-top: auto; /* закрепляет футер внизу */
    }

    /* Видеопоток */
    .stream-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .stream-buttons button {
      background: #8000ba;
    }

    .stream-buttons button:hover {
      background: #390053;
    }

    /* Отчёты */
    .reports-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <header>
    <h1>Система обнаружения мобильных телефонов</h1>
  </header>

  <div class="container">

    <section class="section">
      <h2>Загрузка фото</h2>
      <div class="upload-row">
        <label class="custom-file-upload">
          <input type="file" id="fileInput">
          Выберите файл
        </label>
        <span class="file-name" id="fileName">Файл не выбран</span>
        <button onclick="processImage()" class="process-btn">Обработать фото</button>
      </div>
      <img id="resultImage" src="" alt="Результат" style="display:none;">
      <div id="stats"></div>
    </section>

  <section class="section">
  <h2>Загрузка видео</h2>
  <div class="upload-row">
    <label class="custom-file-upload">
      <input type="file" id="videoFile">
      Выберите файл
    </label>
    <span class="file-name" id="videoFileName">Файл не выбран</span>
    <button onclick="processVideo()" class="process-btn">Обработать видео</button>
  </div>
  <div id="videoStatus" style="font-weight: bold; color: #333; margin-top: 10px;"></div>
  <div id="videoProgressBar" style="height: 20px; background: #eee; border-radius: 5px; overflow: hidden; margin-top: 10px; display: none;">
    <div id="videoProgress" style="height: 100%; width: 0%; background: #8000ba; text-align: center; color: #fff; font-size: 12px; line-height: 20px;"></div>
  </div>
  <div id="videoStats"></div>
</section>

    <section class="section">
      <h2>Видеопоток (реальное время)</h2>
      <div class="stream-buttons">
        <button onclick="startStream()" class="process-btn">Включить поток</button>
        <button onclick="stopStream()" class="process-btn">Выключить поток</button>
      </div>
      <img id="videoStream" src="" width="640" alt="Видеопоток" style="display:none;">
    </section>

    <section class="section">
      <h2>Отчёты</h2>
      <div class="reports-buttons">
        <button onclick="generateReportAll()" class="process-btn">Скачать отчёт за всё время</button>
        <button onclick="generateReportRecent()" class="process-btn">Скачать отчёт за последние 5 минут</button>
      </div>
    </section>

  </div>

  <footer>
    &copy; 2025 Система обнаружения телефонов. Все права защищены.
  </footer>

  <script>
  // Показ выбранного имени файла (фото)
  document.getElementById('fileInput').addEventListener('change', function() {
    const fileName = this.files[0] ? this.files[0].name : 'Файл не выбран';
    document.getElementById('fileName').textContent = fileName;
  });

  // Показ выбранного имени файла (видео)
  document.getElementById('videoFile').addEventListener('change', function() {
    const fileName = this.files[0] ? this.files[0].name : 'Файл не выбран';
    document.getElementById('videoFileName').textContent = fileName;
  });

  // === Фото ===
  async function processImage() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) return alert('Выберите файл!');
    const formData = new FormData();
    formData.append('image', file);

    const response = await fetch('/process', {
      method: 'POST',
      body: formData
    });

    const data = await response.json();

    // Показываем изображение и статистику
    const resultImg = document.getElementById('resultImage');
    resultImg.style.display = 'block';  // показать
    resultImg.src = '/static/result.jpg?' + Date.now();

    document.getElementById('stats').innerText = `Обнаружено: ${data.count} телефонов`;
  }

  // === Видео ===
  // === Видео ===
// === Видео ===
async function processVideo() {
  const file = document.getElementById('videoFile').files[0];
  if (!file) return alert('Выберите видео!');

  const statusBar = document.getElementById('videoStatus');
  const progressBar = document.getElementById('videoProgressBar');
  const progress = document.getElementById('videoProgress');

  statusBar.innerText = '⏳ Видео обрабатывается...';
  progressBar.style.display = 'block';
  progress.style.width = '0%';
  progress.innerText = '0%';

  // Имитация прогресса: плавно увеличиваем %
  let percent = 0;
  const fakeProgress = setInterval(() => {
    if (percent < 95) {
      percent += Math.floor(Math.random() * 3) + 1; // случайное +1..3%
      if (percent > 95) percent = 95;
      progress.style.width = percent + '%';
      progress.innerText = percent + '%';
    }
  }, 200);

  // Отправка запроса
  const formData = new FormData();
  formData.append('video', file);

  const response = await fetch('/process_video', {
    method: 'POST',
    body: formData
  });

  clearInterval(fakeProgress);
  progress.style.width = '100%';
  progress.innerText = '100%';

  const data = await response.json();
  document.getElementById('videoStats').innerText = `Обнаружено на видео: ${data.count} телефонов`;

  statusBar.innerText = '✅ Обработка завершена';
}



  // === Видеопоток ===
  function startStream() {
    const videoStream = document.getElementById('videoStream');
    videoStream.style.display = 'block';  // показать
    videoStream.src = '/video_feed';
  }

  function stopStream() {
    const videoStream = document.getElementById('videoStream');
    videoStream.src = '';
    videoStream.style.display = 'none';  // скрыть
  }

  // === Отчёты ===
  function generateReportAll() {
    fetch('/generate_report_all', {method: 'POST'})
      .then(response => response.blob())
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Отчет_полный.pdf';
        a.click();
      });
  }

  function generateReportRecent() {
    fetch('/generate_report_recent', {method: 'POST'})
      .then(response => response.blob())
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Отчет_5мин.pdf';
        a.click();
      });
  }
</script>

</body>
</html>
